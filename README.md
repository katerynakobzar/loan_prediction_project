# **Loan Prediction Django Project**

## Огляд
Цей проект прогнозує схвалення кредитів на основі введених даних користувачем. 
Модель машинного навчання використовує ряд характеристик заявника для визначення 
ймовірності схвалення кредиту.

## Вміст
1. [Вимоги](#Вимоги)
2. [Встановлення](#Встановлення)
3. [Структура проекту](#Структура-проекту)
4. [Функції та методи](#Функції-та-методи)
5. [Тестування](#Тестування)

## Вимоги
- Python 3.8+
- Django 3.2+
- pandas
- scikit-learn
- joblib
- plotly

## Встановлення
1. Клонуйте репозиторій:
    ```bash
    git clone https://github.com/ваш-репозиторій.git
    ```
2. Перейдіть до каталогу проекту:
    ```bash
    cd loan_prediction_project
    ```
3. Встановіть залежності:
    ```bash
    pip install -r requirements.txt
    ```
4. Виконайте міграції бази даних:
    ```bash
    python manage.py migrate
    ```
5. Запустіть сервер:
    ```bash
    python manage.py runserver
    ```


## Структура проекту

### manage.py
Основний файл для керування Django проектом. Використовується для запуску серверу,
виконання міграцій та інших команд.

### loan_prediction_project/settings.py
Конфігураційний файл проекту, що містить налаштування бази даних, додатків, середовища тощо.

### predictions/views.py
Містить функції-обробники запитів:
- `predict(request)`: Обробляє прогнозування кредиту на основі вхідних даних користувача.
- `feature_importance_view(request)`: Відображає графік важливості ознак.

### predictions/templates/predictions/
Містить HTML шаблони для відображення:
- `predict.html`: Форма для введення даних користувача.
- `result.html`: Сторінка з результатом прогнозування.
- `feature_importance.html`: Сторінка з графіком важливості ознак.

### predictions/utils/loan_prediction.py
Містить функцію predict_with_rule, яка здійснює прогнозування кредиту з урахуванням правила 
співвідношення доходу до щомісячного платежу..

### predictions/urls.py
Налаштовує маршрути для додатку `predictions`.

### train_model.py

1. Завантаження даних: Завантаження даних з CSV файлу.
2. Імпорт необхідних бібліотек: pandas, seaborn, matplotlib, os, joblib, json, numpy, scikit-learn.
3. Обробка відсутніх значень: Видалення записів з відсутніми значеннями.
4. Додавання нових ознак: Обчислення нових ознак, таких як Income_to_Loan_Ratio, Log_ApplicantIncome, Income_Category.
5. Кореляційний аналіз: Аналіз кореляційних зв'язків між числовими ознаками за допомогою heatmap.
6. Розділення ознак і цільової змінної: Розділення даних на X (ознаки) та y (цільова змінна).
7. Обробка категоріальних змінних: Перетворення категоріальних ознак у dummy variables.
8. Розділення на навчальний і тестовий набори: train_test_split з scikit-learn.
9. Попередня обробка числових даних: Створення ColumnTransformer для стандартизації числових ознак.
10. Створення пайплайна: Пайплайн, який включає попередню обробку та модель RandomForestClassifier.
11. Визначення параметрів для GridSearchCV: Параметри, які будуть оптимізовані у GridSearchCV
12. Виконання GridSearchCV: Навчання моделі та оптимізація параметрів.
13. Збереження моделі: Збереження навченої моделі у файл з використанням joblib.
14. Збереження важливості ознак: Визначення важливості ознак і збереження їх у JSON файл.
15. Прогнозування на тестових даних: Виконання прогнозування на тестових даних.
16. Застосування правила для оновлення прогнозів: Перевірка, чи дохід більший за щомісячний платіж, і 
    оновлення прогнозів на основі цього правила.
17. Виведення фінальних результатів: Виведення оригінальних та оновлених прогнозів.

## Функції та методи
### Функція `predict_with_rule`


    """ 
    Прогнозує рішення про кредит з урахуванням правила співвідношення доходу до щомісячного платежу.
    Args: 
    input_data (dict): Вхідні дані для прогнозування. 
    Returns:
    str: 'Approved' або 'No Approved'. 


    """

### Функція `predict`
def predict(request):
   
    """


    Обробляє POST та GET запити для прогнозування схвалення кредиту.
    
    Якщо запит метод POST, функція отримує дані з форми, створює DataFrame
    і виконує прогнозування за допомогою завантаженої моделі.
    Якщо запит метод GET, функція повертає порожню форму.
    
    Параметри:
    request (HttpRequest): HTTP запит.
    
    Повертає:
    HttpResponse: Відповідь з результатом прогнозування або форма.
    """

### Функція safe_float
def safe_float(value):
   
    """

    Конвертує значення у float з перевіркою на помилки.
    
    """

### Функція feature_importance_view
def feature_importance_view(request):

    """

    Відображає графік важливості ознак моделі.
    
    Завантажує важливість ознак з JSON файлу та створює графік
    за допомогою Plotly. Графік рендериться у HTML шаблоні.
    
    Параметри:
    request (HttpRequest): HTTP запит.
    
    Повертає:
    HttpResponse: Відповідь з графіком важливості ознак.
    """
### Тестування

Тестування проекту здійснюється за допомогою модуля Django TestCase.

Для запуску тестів використовуйте команду:
```bash
    python -m unittest discover
  ```

### Функція def setUp(self):
    # Ініціалізація клієнта для тестування HTTP-запитів
    # Путь до моделі машинного навчання
    # Перевірка існування моделі

### Функція def test_model_loading(self):
    """Перевірка, чи завантажується модель успішно."""

### Функція def test_model_prediction(self):
    """Перевірка, чи робить модель прогнози."""

### Функція def test_homepage_view(self):
    """Перевірка доступності домашньої сторінки."""
